/**
* @version 0.0.1
* @link https://github.com/gajus/contents for the canonical source repository
* @license https://github.com/gajus/contents/blob/master/LICENSE BSD 3-Clause
*/
!function(e){"use strict";e.gajus=e.gajus||{},e.gajus.contents=function(t){var n,r,o,a,s;return t=e.gajus.contents.options(t),n=e.gajus.contents.getHeadings(t.content),e.gajus.contents.giveId(n,t.anchorFormatter),r=e.gajus.contents.generateHeadingHierarchyList(n,t.itemFormatter),t.where.append(r),s=function(){o=e.gajus.contents.offsetIndex(n,t.offsetCalculator),e(window).trigger("scroll")},s(),r.on("resize.gajus.contents",s),e(window).on("resize orientationchange",s),e(window).on("scroll",function(){var t,n;t=e.gajus.contents.getInOffsetIndex(e.gajus.contents.scrollTop(),o).element,a!==t&&(n={},n.current={heading:t,anchor:r.find("li").filter(function(){return e(this).data("gajus.contents.heading")===t[0]})},a&&(n.previous={heading:a,anchor:r.find("li").filter(function(){return e(this).data("gajus.contents.heading")===a[0]})}),r.trigger("change.gajus.contents",n),a=t)}),setTimeout(function(){r.trigger("scroll")},10),r},e.gajus.contents.options=function(t){if(!t)throw new Error("Missing setup options.");if(!t.where)throw new Error('Option "where" is not set.');if(!(t.where instanceof jQuery))throw new Error('Option "where" is not a jQuery object.');if(!t.where.length)throw new Error('Option "where" does not refer to an existing element.');if(t.where.length>1)throw new Error('Option "where" refers to more than one element.');if(!t.content)throw new Error('Option "content" is not set.');if(!(t.content instanceof jQuery))throw new Error('Option "content" is not a jQuery object.');if(!t.content.length)throw new Error('Option "content" does not refer to an existing element.');if(t.itemFormatter&&"function"!=typeof t.itemFormatter)throw new Error('Option "itemFormatter" must be a function.');if(t.anchorFormatter){if("function"!=typeof t.anchorFormatter)throw new Error('Option "anchorFormatter" must be a function.')}else t.anchorFormatter=e.gajus.contents.anchorFormatter;if(t.offsetCalculator){if("function"!=typeof t.offsetCalculator)throw new Error('Option "offsetCalculator" must be a function.')}else t.offsetCalculator=e.gajus.contents.offsetIndex.offsetCalculator;return t},e.gajus.contents.getHeadings=function(e){var t;if(!e.length)throw new Error("Target element does not exist.");if(t=e.find("h1, h2, h3, h4, h5, h6"),!t.length)throw new Error("Target element does not contain heading elements.");return t},e.gajus.contents.deriveId=function(t,n){var r,o,a,s=1;if(n||(n=e.gajus.contents.anchorFormatter),1!=t.length)throw new Error("Must reference a single element.");if(t.attr("id"))throw new Error("Already has an ID.");if(r=t.text(),!r.length)throw new Error("Must have text.");for(o=n(r),a=o;e(document).find("#"+a).length;)a=o+"-"+s++;return a},e.gajus.contents.giveId=function(t,n){t.each(function(){var t=e(this);t.attr("id")||t.attr("id",e.gajus.contents.deriveId(t,n))})},e.gajus.contents.anchorFormatter=function(e){return e.toLowerCase().replace(/[ãàáäâ]/g,"a").replace(/[ẽèéëê]/g,"e").replace(/[ìíïî]/g,"i").replace(/[õòóöô]/g,"o").replace(/[ùúüû]/g,"u").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/\s+/g,"-").replace(/[^a-z0-9\-_]+/g,"-").replace(/\-+/g,"-").replace(/^\-|\-$/g,"").replace(/^[^a-z]+/g,"")},e.gajus.contents.generateHeadingHierarchyList=function(t,n){var r,o,a,s=e("<ul>"),i=s,c=[];return n||(n=e.gajus.contents.generateHeadingHierarchyList.itemFormatter),r=function(e){for(;e>0;){if(c[e])return c[e];e--}throw new Error("Invalid markup.")},t.each(function(){var t=e(this),s=parseInt(t.prop("tagName").slice(1),10),f=e("<li>");f.data("gajus.contents.heading",t[0]),n(f,t),c=c.slice(0,s+1),a&&a!==s?s>a?(i=e("<ul>"),i.append(f),o.append(i)):r(s).append(f):i.append(f),c[s]=i,a=s,o=f}),s},e.gajus.contents.generateHeadingHierarchyList.itemFormatter=function(t,n){var r=e("<a>");r.text(n.text()),r.attr("href","#"+n.attr("id")),t.append(r)},e.gajus.contents.scrollTop=function(){return e.gajus.contents._scrollTop?e.gajus.contents._scrollTop:e(window).scrollTop()},e.gajus.contents._scrollTop=null,e.gajus.contents.offsetIndex=function(t,n){var r=[],o=0;return n&&(o=n()),t.each(function(){var t=e(this),n=t.offset().top,a=n;a-=o,a=5*Math.round(a/5),r.push({element:t,offset:a,realOffset:n})}),r},e.gajus.contents.offsetIndex.offsetCalculator=function(){return e(window).height()/3},e.gajus.contents.getInOffsetIndex=function(e,t){var n=0;if(t[0].offset>e)return t[0];for(;n<t.length;){if(e>=t[n].offset&&(!t[n+1]||e<t[n+1].offset))return t[n];n++}}}(jQuery);