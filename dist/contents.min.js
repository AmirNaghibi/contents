/**
* @version 0.0.1
* @link https://github.com/gajus/contents for the canonical source repository
* @license https://github.com/gajus/contents/blob/master/LICENSE BSD 3-Clause
*/
!function(t){"use strict";t.gajus=t.gajus||{},t.gajus.contents=function(e){var n,r,o,a;return e=t.gajus.contents.options(e),n=t.gajus.contents.getHeadings(e.content),t.gajus.contents.giveId(n,e.anchorFormatter),r=t.gajus.contents.generateHeadingHierarchyList(n,e.itemFormatter),e.where.append(r),o=t.gajus.contents.offsetIndex(n,e.offsetCalculator),t(window).on("scroll",function(){var e,n;e=t.gajus.contents.getInOffsetIndex(t.gajus.contents.scrollTop(),o).element,a!==e&&(n={},n.current={heading:e,anchor:r.find("li").filter(function(){return t(this).data("gajus.contents.heading")===e[0]})},a&&(n.previous={heading:a,anchor:r.find("li").filter(function(){return t(this).data("gajus.contents.heading")===a[0]})}),r.trigger("change.gajus.contents",n),a=e)}),setTimeout(function(){r.trigger("scroll")},10),r},t.gajus.contents.options=function(e){if(!e)throw new Error("Missing setup options.");if(!e.where)throw new Error('Option "where" is not set.');if(!(e.where instanceof jQuery))throw new Error('Option "where" is not a jQuery object.');if(!e.where.length)throw new Error('Option "where" does not refer to an existing element.');if(e.where.length>1)throw new Error('Option "where" refers to more than one element.');if(!e.content)throw new Error('Option "content" is not set.');if(!(e.content instanceof jQuery))throw new Error('Option "content" is not a jQuery object.');if(!e.content.length)throw new Error('Option "content" does not refer to an existing element.');if(e.itemFormatter&&"function"!=typeof e.itemFormatter)throw new Error('Option "itemFormatter" must be a function.');if(e.anchorFormatter){if("function"!=typeof e.anchorFormatter)throw new Error('Option "anchorFormatter" must be a function.')}else e.anchorFormatter=t.gajus.contents.anchorFormatter;if(e.offsetCalculator){if("function"!=typeof e.offsetCalculator)throw new Error('Option "offsetCalculator" must be a function.')}else e.offsetCalculator=t.gajus.contents.offsetIndex.offsetCalculator;return e},t.gajus.contents.getHeadings=function(t){var e;if(!t.length)throw new Error("Target element does not exist.");if(e=t.find("h1, h2, h3, h4, h5, h6"),!e.length)throw new Error("Target element does not contain heading elements.");return e},t.gajus.contents.deriveId=function(e,n){var r,o,a,s=1;if(n||(n=t.gajus.contents.anchorFormatter),1!=e.length)throw new Error("Must reference a single element.");if(e.attr("id"))throw new Error("Already has an ID.");if(r=e.text(),!r.length)throw new Error("Must have text.");for(o=n(r),a=o;t(document).find("#"+a).length;)a=o+"-"+s++;return a},t.gajus.contents.giveId=function(e,n){e.each(function(){var e=t(this);e.attr("id")||e.attr("id",t.gajus.contents.deriveId(e,n))})},t.gajus.contents.anchorFormatter=function(t){return t.toLowerCase().replace(/[ãàáäâ]/g,"a").replace(/[ẽèéëê]/g,"e").replace(/[ìíïî]/g,"i").replace(/[õòóöô]/g,"o").replace(/[ùúüû]/g,"u").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/\s+/g,"-").replace(/[^a-z0-9\-_]+/g,"-").replace(/\-+/g,"-").replace(/^\-|\-$/g,"").replace(/^[^a-z]+/g,"")},t.gajus.contents.generateHeadingHierarchyList=function(e,n){var r,o,a,s=t("<ul>"),i=s,c=[];return n||(n=t.gajus.contents.generateHeadingHierarchyList.itemFormatter),r=function(t){for(;t>0;){if(c[t])return c[t];t--}throw new Error("Invalid markup.")},e.each(function(){var e=t(this),s=parseInt(e.prop("tagName").slice(1),10),f=t("<li>");f.data("gajus.contents.heading",e[0]),n(f,e),c=c.slice(0,s+1),a&&a!==s?s>a?(i=t("<ul>"),i.append(f),o.append(i)):r(s).append(f):i.append(f),c[s]=i,a=s,o=f}),s},t.gajus.contents.generateHeadingHierarchyList.itemFormatter=function(e,n){var r=t("<a>");r.text(n.text()),r.attr("href","#"+n.attr("id")),e.append(r)},t.gajus.contents.scrollTop=function(){return t.gajus.contents._scrollTop?t.gajus.contents._scrollTop:t(window).scrollTop()},t.gajus.contents._scrollTop=null,t.gajus.contents.offsetIndex=function(e,n){var r=[],o=0;return n&&(o=n()),e.each(function(){var e=t(this),n=e.offset().top,a=n;a-=o,a=5*Math.round(a/5),r.push({element:e,offset:a,realOffset:n})}),r},t.gajus.contents.offsetIndex.offsetCalculator=function(){return t(window).height()/3},t.gajus.contents.getInOffsetIndex=function(t,e){var n=0;if(e[0].offset>t)return e[0];for(;n<e.length;){if(t>=e[n].offset&&(!e[n+1]||t<e[n+1].offset))return e[n];n++}}}(jQuery);