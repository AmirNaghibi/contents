/**
* @version 0.0.1
* @link https://github.com/gajus/contents for the canonical source repository
* @license https://github.com/gajus/contents/blob/master/LICENSE BSD 3-Clause
*/
!function(e){"use strict";e.gajus=e.gajus||{},e.gajus.contents=function(t){var n,r,o,s;return t=e.gajus.contents.options(t),n=e.gajus.contents.getHeadings(t.content),e.gajus.contents.giveId(n,t.slug),r=e.gajus.contents.generateHeadingHierarchyList(n),t.where.append(r),o=e.gajus.contents.offsetIndex(n,t.offset),e(window).on("scroll",function(){var t,n;t=e.gajus.contents.getInOffsetIndex(e.gajus.contents.scrollTop(),o).element,s!==t&&(n={},n.current={heading:t,anchor:r.find("li").filter(function(){return e(this).data("gajus.contents.heading")===t[0]})},s&&(n.previous={heading:s,anchor:r.find("li").filter(function(){return e(this).data("gajus.contents.heading")===s[0]})}),r.trigger("change.gajus.contents",n),s=t)}),setTimeout(function(){r.trigger("scroll")},10),r},e.gajus.contents.options=function(t){if(!t)throw new Error("Missing setup options.");if(!t.where)throw new Error('Option "where" is not set.');if(!(t.where instanceof jQuery))throw new Error('Option "where" is not a jQuery object.');if(!t.where.length)throw new Error('Option "where" does not refer to an existing element.');if(t.where.length>1)throw new Error('Option "where" refers to more than one element.');if(!t.content)throw new Error('Option "content" is not set.');if(!(t.content instanceof jQuery))throw new Error('Option "content" is not a jQuery object.');if(!t.content.length)throw new Error('Option "content" does not refer to an existing element.');return t.slug||(t.slug=e.gajus.contents.toSlug),t.offset||(t.offset=e(window).height()/3),t},e.gajus.contents.getHeadings=function(e){var t;if(!e.length)throw new Error("Target element does not exist.");if(t=e.find("h1, h2, h3, h4, h5, h6"),!t.length)throw new Error("Target element does not contain heading elements.");return t},e.gajus.contents.deriveId=function(t,n){var r,o,s,a=1;if(n||(n=e.gajus.contents.toSlug),1!=t.length)throw new Error("Must reference a single element.");if(t.attr("id"))throw new Error("Already has an ID.");if(r=t.text(),!r.length)throw new Error("Must have text.");for(o=n(r),s=o;e(document).find("#"+s).length;)s=o+"-"+a++;return s},e.gajus.contents.giveId=function(t,n){t.each(function(){var t=e(this);t.attr("id")||t.attr("id",e.gajus.contents.deriveId(t,n))})},e.gajus.contents.toSlug=function(e){return e.toLowerCase().replace(/[ãàáäâ]/g,"a").replace(/[ẽèéëê]/g,"e").replace(/[ìíïî]/g,"i").replace(/[õòóöô]/g,"o").replace(/[ùúüû]/g,"u").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/\s+/g,"-").replace(/[^a-z0-9\-_]+/g,"-").replace(/\-+/g,"-").replace(/^\-|\-$/g,"")},e.gajus.contents.generateHeadingHierarchyList=function(t,n){var r,o,s,a=e("<ul>"),i=a,c=[];return n||(n=function(t,n){var r=e("<a>");r.text(n.text()),r.attr("href","#"+n.attr("id")),t.append(r)}),r=function(e){for(;e>0;){if(c[e])return c[e];e--}throw new Error("Invalid markup.")},t.each(function(){var t=e(this),a=parseInt(t.prop("tagName").slice(1),10),u=e("<li>");u.data("gajus.contents.heading",t[0]),n(u,t),c=c.slice(0,a+1),s&&s!==a?a>s?(i=e("<ul>"),i.append(u),o.append(i)):r(a).append(u):i.append(u),c[a]=i,s=a,o=u}),a},e.gajus.contents._scrollTop=null,e.gajus.contents.scrollTop=function(){return e.gajus.contents._scrollTop?e.gajus.contents._scrollTop:e(window).scrollTop()},e.gajus.contents.offsetIndex=function(t,n){var r=[];return n=n||0,t.each(function(){var t=e(this),o=t.offset().top,s=o;s-=n,s=5*Math.round(s/5),r.push({element:t,offset:s,realOffset:o})}),r},e.gajus.contents.getInOffsetIndex=function(e,t){var n=0;if(t[0].offset>e)return t[0];for(;n<t.length;){if(e>=t[n].offset&&(!t[n+1]||e<t[n+1].offset))return t[n];n++}}}(jQuery);