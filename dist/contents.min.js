/**
* @version 0.0.2
* @link https://github.com/gajus/contents for the canonical source repository
* @license https://github.com/gajus/contents/blob/master/LICENSE BSD 3-Clause
*/
!function(t){var n;n=window.gajus=window.gajus||{},n.contents=function(e){var r,o;return e=n.contents.config(e),r=n.contents.makeList(e.articles),o=r.find("li"),o.each(function(n){e.link(t(this),e.articles.eq(n))}),e.contents.append(r),function(){var i,a,c;r.on("resize.gajus.contents",function(){var s=t(window).height();c=n.contents.indexOffset(e.articles),i||(i=!0,t(window).on("scroll",n.contents.throttle(function(){var i,l;i=n.contents.getIndexOfClosestValue(t(window).scrollTop()+.2*s,c),i!==a&&(l={},l.current={article:e.articles.eq(i),guide:o.eq(i)},void 0!==a&&(l.previous={article:e.articles.eq(a),guide:o.eq(a)}),r.trigger("change.gajus.contents",l),a=i)},100)),r.trigger("ready.gajus.contents")),t(window).trigger("scroll")}),t(window).on("resize orientationchange",n.contents.throttle(function(){r.trigger("resize.gajus.contents")},100)),setTimeout(function(){r.trigger("resize.gajus.contents")},10)}(),r},n.contents.config=function(e){var r=["contents","articles","link"];if(e=e||{},t.each(e,function(t){if(-1===r.indexOf(t))throw new Error("Unknown configuration property.")}),!e.contents)throw new Error('Option "contents" is not set.');if(!(e.contents instanceof jQuery))throw new Error('Option "contents" is not a jQuery object.');if(e.articles){if(!(e.articles instanceof jQuery))throw new Error('Option "articles" is not a jQuery object.')}else e.articles=t("body").find("h1, h2, h3, h4, h5, h6");if(e.link){if("function"!=typeof e.link)throw new Error('Option "link" must be a function.')}else e.link=n.contents.link;return e},n.contents.id=function(e,r){var o,i,a=1;if(r||(r=n.contents.formatId),o=r(e),!o.match(/^[a-z]+[a-z0-9\-_:\.]*$/))throw new Error("Invalid ID.");for(i=o;t(document).find("#"+i).length;)i=o+"-"+a++;return i},n.contents.formatId=function(t){return t.toLowerCase().replace(/[ãàáäâ]/g,"a").replace(/[ẽèéëê]/g,"e").replace(/[ìíïî]/g,"i").replace(/[õòóöô]/g,"o").replace(/[ùúüû]/g,"u").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/\s+/g,"-").replace(/[^a-z0-9\-_]+/g,"-").replace(/\-+/g,"-").replace(/^\-|\-$/g,"").replace(/^[^a-z]+/g,"")},n.contents.makeList=function(e){var r,o,i,a=t("<ol>"),c=a,s=[];return r=function(t){for(;t>0;){if(s[t])return s[t];t--}throw new Error("Invalid markup.")},e.each(function(){var e,a=t(this),l=t("<li>");e=n.contents.level(a),s=s.slice(0,e+1),i&&i!==e?e>i?(c=t("<ol>"),c.append(l),o.append(c)):(c=r(e),c.append(l)):c.append(l),s[e]=c,i=e,o=l}),a},n.contents.level=function(t){var n=t.prop("tagName").toLowerCase();return-1!==["h1","h2","h3","h4","h5","h6"].indexOf(n)?parseInt(n.slice(1),10):t.data("gajus.contents.level")||1},n.contents.link=function(e,r){var o=t("<a>"),i=t("<a>"),a=r.text(),c=r.attr("id")||n.contents.id(a);o.text(a).attr("href","#"+c).prependTo(e),i.attr("href","#"+c),r.attr("id",c).wrapInner(i)},n.contents.indexOffset=function(n){var e=[];return n.each(function(){var n=t(this).offset().top;n=5*Math.round(n/5),e.push(n)}),e},n.contents.getIndexOfClosestValue=function(t,n){var e,r=0,o=0,i=n.length;if(!i)throw new Error("Haystack must be not empty.");for(;i>o&&(Math.abs(t-n[r])>Math.abs(n[o]-t)&&(r=o),r!==e);)e=r,o++;return r},n.contents.throttle=function(t,n,e){var r,o;return n=n||250,e=e||{},function(){var i=+new Date,a=arguments;r&&r+n>i?(clearTimeout(o),o=setTimeout(function(){r=i,t.apply(e,a)},n)):(r=i,t.apply(e,a))}}}(jQuery);